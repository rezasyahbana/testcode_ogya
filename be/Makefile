.PHONY: build build-linux build-windows build-all clean run test

# Default build for current platform
build:
	@echo "ğŸ”¨ Building for current platform..."
	go build -o bin/generator cmd/app/main.go
	@echo "âœ… Build complete: bin/generator"

# Build for Linux
build-linux:
	@echo "ğŸ§ Building for Linux (amd64)..."
	GOOS=linux GOARCH=amd64 go build -o bin/generator-linux cmd/app/main.go
	@chmod +x bin/generator-linux
	@echo "âœ… Build complete: bin/generator-linux"

# Build for Windows
build-windows:
	@echo "ğŸªŸ Building for Windows (amd64)..."
	GOOS=windows GOARCH=amd64 go build -o bin/generator-win.exe cmd/app/main.go
	@echo "âœ… Build complete: bin/generator-win.exe"

# Build for all platforms
build-all: build-linux build-windows
	@echo "ğŸ‰ All builds complete!"
	@ls -lh bin/

# Clean build artifacts
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -rf bin/
	rm -f *.csv *.json *.sql
	@echo "âœ… Clean complete"

# Run the application with default config
run: build
	@echo "ğŸš€ Running generator..."
	./bin/generator request-conf.json

# Run tests
test:
	@echo "ğŸ§ª Running tests..."
	go test -v ./...

# Download dependencies
deps:
	@echo "ğŸ“¦ Downloading dependencies..."
	go mod download
	go mod tidy
	@echo "âœ… Dependencies ready"

# Install required packages
install-deps:
	@echo "ğŸ“¦ Installing required packages..."
	go get github.com/google/uuid
	go mod tidy
	@echo "âœ… Dependencies installed"

# Build with optimizations (smaller binary)
build-optimized:
	@echo "âš¡ Building optimized binary..."
	go build -ldflags="-s -w" -o bin/generator-optimized cmd/app/main.go
	@echo "âœ… Optimized build complete"

# Show help
help:
	@echo "Available commands:"
	@echo "  make build          - Build for current platform"
	@echo "  make build-linux    - Build for Linux"
	@echo "  make build-windows  - Build for Windows"
	@echo "  make build-all      - Build for all platforms"
	@echo "  make clean          - Remove build artifacts"
	@echo "  make run            - Build and run with default config"
	@echo "  make test           - Run tests"
	@echo "  make deps           - Download dependencies"
	@echo "  make install-deps   - Install required packages"
	@echo "  make help           - Show this help message"
